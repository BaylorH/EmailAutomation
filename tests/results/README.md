# Test Results

This directory contains E2E test results generated by `python3 tests/e2e_test.py --save`.

## Directory Structure

```
results/
├── run_YYYYMMDD_HHMMSS/           # Each test run creates a timestamped directory
│   ├── manifest.json              # Run metadata + input file info
│   ├── summary.json               # Campaign-level results
│   ├── {property_address}.json    # Individual result files
│   └── edge_{scenario}.json       # Edge case result files
```

## Result File Structure

Each result file contains:

```json
{
  "property_address": "1 Kuhlke Dr",
  "passed": true,

  "input": {
    "row_number": 6,
    "city": "Augusta",
    "contact": "Robert McCrary",
    "email": "broker@example.com",
    "columns": { "Total SF": "", "Rent/SF /Yr": "", ... }
  },

  "conversation": {
    "description": "...",
    "messages": [
      {"direction": "outbound", "content": "..."},
      {"direction": "inbound", "content": "..."}
    ]
  },

  "output": {
    "updates": [ {"column": "Total SF", "value": "22500", ...} ],
    "events": [ {"type": "call_requested", ...} ],
    "response_email": "...",
    "notes": "..."
  },

  "sheet_state": {
    "before": { "Total SF": "", ... },
    "after": { "Total SF": "22500", ... },
    "changes": [ {"column": "Total SF", "before": "", "after": "22500"} ]
  },

  "notifications": [
    {"kind": "sheet_update", "column": "Total SF", "value": "22500"},
    {"kind": "row_completed"}
  ],

  "validation": {
    "expected_updates": [...],
    "expected_events": [...],
    "forbidden_updates": ["Leasing Contact", ...],
    "issues": [],
    "warnings": []
  }
}
```

## Commands

```bash
# Run tests and save results
python3 tests/e2e_test.py --all --save

# List previous test runs
python3 tests/e2e_test.py --list-runs

# Compare two runs
python3 tests/e2e_test.py --compare run_20240115_100000 run_20240115_110000

# Use custom Excel file
python3 tests/e2e_test.py --all --save --scrub "path/to/custom.xlsx"
```

## Coordinated Hierarchy

```
Input Excel File (Scrub Augusta GA.xlsx)
  └── properties (rows 3+)
       └── 1 Kuhlke Dr
       └── 699 Industrial Park Dr
       └── ...

Conversations (tests/conversations/)
  └── 1_kuhlke_dr.json → tests property "1 Kuhlke Dr"
  └── 699_industrial_park_dr.json → tests property "699 Industrial Park Dr"
  └── edge_cases/
       └── hostile_response.json → tests edge case for "699 Industrial Park Dr"

Results (tests/results/run_YYYYMMDD_HHMMSS/)
  └── 1_kuhlke_dr.json → result for conversation → for property
  └── 699_industrial_park_dr.json
  └── edge_hostile_response.json
```

This hierarchy allows you to:
1. Modify the Excel file (add/remove columns, change data)
2. Re-run tests with `--save`
3. Compare results between runs to detect behavioral changes
